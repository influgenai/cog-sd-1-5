#!/usr/bin/env python3
print("Running download_weights")

import os
# from diffusers import StableDiffusionImg2ImgPipeline
from diffusers import DiffusionPipeline
import requests

MODEL_CACHE = "diffusers-cache"
os.makedirs(MODEL_CACHE, exist_ok=True)

def download_large_file(url, filename):
    """Download a large file in chunks."""
    with requests.get(url, stream=True) as r:
        r.raise_for_status()
        with open(filename, 'wb') as f:
            for chunk in r.iter_content(chunk_size=8192): 
                f.write(chunk)

# URL of the large file you want to download
output_filename = 'diffusers-cache/lora.safetensors'
# lora_path = "https://civitai.com/api/download/models/129193"
lora_path = "https://civitai.com/api/download/models/286157"

# # Download the large file
download_large_file(lora_path, output_filename)

# model_id = "runwayml/stable-diffusion-v1-5"
# model_id = "stablediffusionapi/epicrealism5"
model_id = "redstonehero/epicrealism_pureevolutionv5"

# better_vae = AutoencoderKL.from_pretrained(
#     "madebyollin/sdxl-vae-fp16-fix", torch_dtype=torch.float16
# )

pipe = DiffusionPipeline.from_pretrained(model_id, cache_dir=MODEL_CACHE)
# pipe.load_lora_weights(lora_path, use_safetensors=True)